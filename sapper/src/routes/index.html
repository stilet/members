<svelte:head>
	<title>Sapper project template</title>
</svelte:head>

<section>
	<form on:submit='login(event)'>
		<div>
			<label for='login-name'>
				Name
			</label>
			<input
				id='login-name'
				type='text'
				required
				bind:value=username
			/>
		</div>
		<div>
			<label for='login-password'>
				Password
			</label>
			<input
				required
				type='text'
				id='login-password'
				bind:value=password
			/>
		</div>
		<div>
			<button type='submit'>
				Login
			</button>
		</div>
	</form>

	<pre>
		{JSON.stringify(form, null, 2)}
	</pre>

	Result:
	<pre>
		{JSON.stringify(result, null, 2)}
	</pre>

</section>

<style>
	pre {
		white-space: pre-wrap;
		word-break: break-all;
	}
</style>

<script>
  import gql from 'graphql-tag'

	export default {
		data() {
			return {
				username: '',
				password: ''
			}
		},
		computed: {
			form: ({ username, password }) => ({ username, password })
		},
		methods: {
			async login(e) {
				const { form } = this.get()

				e.preventDefault()
				e.stopPropagation()
				try {
					const res = await fetch('/login', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json'
						},
						body: JSON.stringify(form)
					})

					console.log("Logging in", form, res)
					this.set({
						result: {
							status: res.status,
							data: await res.json()
						}
					})
					
				} catch (e) {
					console.error(e)
				}
			}
		}
	}
</script>