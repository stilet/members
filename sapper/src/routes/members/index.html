<svelte:head>
  <title>Wolbodo members</title>
</svelte:head>

<input
  type="text"
  placeholder="Zoek..."
  bind:value="filter"/>

{#await getUsers}
  <tr><td>Loading</td></tr>
{:then result}
  <Table
    filter={filter}
    data={result.data.account_user}
    columns={columns}
    rowUrl={row => `/members/${row.name}`}
  />
{:catch error}
  <tr><td>ERROR: {JSON.stringify(error)}</td></tr>
{/await}

<script>
import { subscription, query, connect } from 'svelte-apollo'
import gql from 'graphql-tag';

const GET_USERS = gql`subscription{
  user {
    id name email phone
  }
}`

export default {
  components: {
    Table: '../../components/Table.html'
  },
  data() {
    return {
      filter: '',
      getUsers: subscription(GET_USERS),
      columns: ['name', 'email', 'phone']
    }
  },
  oncreate() {
    this.store.graphqlConnect(this)
  },
  // async preload () {
  //   try {

  //     const { graphqlClient } = this.store.get()
  //     if (graphqlClient) {
  //       console.log("Got client")
  //       const subscription = graphqlClient.watchQuery({
  //         query: GET_USERS
  //       })
  //       console.log(subscription)

  //       return {
  //         users: await subscription.result() 
  //       }
  //     } else {
  //       console.log("No client :S")
  //     }
  //   } catch (e) {
  //     console.error(e)
  //   }
  // }
}
</script>