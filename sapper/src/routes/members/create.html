<h1 class='title'>Add member</h1>

<MemberEdit
  on:submit=createMember(event)
  {loading} 
/>

<script>
  import gql from 'graphql-tag'

  export default {
    components: {
      MemberEdit: 'src/components/MemberEdit.html'
    },
    methods: {
      async createMember(data) {
        try {
          this.set({ loading: true })
          const res = await this.store.addMember(data)
          console.log("result:", res)
          this.store.notify('success', 'Member added')
          this.set({ loading: false })
        } catch (e) {
          console.error("Error trying to create member", e)
        }
      }
    },
    async preload () {
      const { loggedIn, permissions } = this.store.get()
      
      if (!loggedIn) {
        return this.redirect(302, '/login')
      }

      if (!permissions.includes('member:create')) {
        return this.redirect(302, '/')
      }

      return {}
    }
  }
</script>